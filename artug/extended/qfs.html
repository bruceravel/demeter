<!DOCTYPE HTMP PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Understanding the quick first shell tool in Artemis</title>
    <link rel="stylesheet" href=../artug.css />
    <link rel="stylesheet" href=../ppi.css />
    <meta http-equiv="Content-Type" content="text/html"; charset=iso-8859-15 />
    <meta name="robots" contents="all" />
  </head>

  <body>
    <div class=topbar>
  <div class=navbar>
  <a class=navhead href="../index.html">The Artemis Users' Guide</a>
  <table class=navtable>
    <tr>
      <td align=left>
        &laquo;<a class=navtable href="http://bruceravel.github.io/demeter/"><span class=programlink>DEMETER</span></a>&raquo; &nbsp;
        &laquo;<a class=navtable href="https://github.com/newville/ifeffit"><span class=programlink>IFEFFIT</span></a>&raquo; &nbsp;
        <!-- [&nbsp;<a class=navtable href="http://leonardo.phys.washington.edu/feff/wiki/index.php?title=FEFF_Documentation"><span class=programlink>FEFF</span></a>&nbsp;] &nbsp; -->
        &laquo;<a class=navtable href="http://xafs.org">xafs.org</a>&raquo; &nbsp;
	<!-- [&nbsp;<a class=navtable href="../demeter.pdf">PDF&nbsp;doc</a>&nbsp;] -->
      </td>
      <td align=right>
        &nbsp;&nbsp;
        Up: <a class=navtable href="../extended/index.html" class="menu">Extended topics</a> &nbsp;&nbsp;
        Next: <a class=navtable href="../extended/cv.html" class="menu">Characteristic value</a>      </td>
    </tr>
  </table>
  </div>
</div>

<div class=sidebar>
  <a href="../diana.html"><img src=../../images/Artemis_logo.jpg
    width=90% border=0 alt='[Artemis logo]'></a>
  <br />
  <a href="../index.html"  class="menu">Home</a><br />
<a href="../intro.html"  class="menu">Introduction</a><br />
<a href="../startup/index.html"  class="menu">Starting Artemis</a><br />
<a href="../data.html"  class="menu">The Data window</a><br />
<a href="../feff/index.html"  class="menu">The Atoms/Feff window</a><br />
<a href="../path/index.html"  class="menu">The Path page</a><br />
<a href="../gds.html"  class="menu">The GDS window</a><br />
<a href="../fit/index.html"  class="menu">Running a fit</a><br />
<a href="../plot/index.html"  class="menu">The Plot window</a><br />
<a href="../logjournal.html"  class="menu">The Log & Journal windows</a><br />
<a href="../history.html"  class="menu">The History window</a><br />
<a href="../monitor.html"  class="menu">Monitoring things</a><br />
<a href="../prefs.html"  class="menu">Managing preferences</a><br />
<a href="../examples/index.html"  class="menu">Worked examples</a><br />
<a href="../atoms/index.html"  class="menu">Crystallography for EXAFS</a><br />
<a href="../extended/index.html"  class="menuselect">Extended topics</a><br />
&nbsp;&#8618;&nbsp;<span style="font-style: italic;">Quick first shell theory</span><br />
&nbsp;&#8618;&nbsp;<a href="../extended/cv.html"  class="menu">Characteristic value</a><br />
&nbsp;&#8618;&nbsp;<a href="../extended/delr.html"  class="menu">Modeling bond length</a><br />
&nbsp;&#8618;&nbsp;<a href="../extended/ss.html"  class="menu">Modeling disorder</a><br />
&nbsp;&#8618;&nbsp;<a href="../extended/constraints.html"  class="menu">Constraints and restraints</a><br />
&nbsp;&#8618;&nbsp;<a href="../extended/bvs.html"  class="menu">Bond valence sums</a><br />
&nbsp;&#8618;&nbsp;<a href="../extended/empirical.html"  class="menu">Using empirical standards</a><br />
&nbsp;&#8618;&nbsp;<a href="../extended/ipots.html"  class="menu">Unique potentials</a><br />
&nbsp;&#8618;&nbsp;<a href="../extended/fuzzy.html"  class="menu">Fuzzy degeneracy</a><br />
&nbsp;&#8618;&nbsp;<a href="../extended/dopants.html"  class="menu">Handling dopants</a><br />
&nbsp;&#8618;&nbsp;<a href="../extended/fivesix.html"  class="menu">5 and 6 legged paths</a><br />
</div>

<div class=contentarea>


<h1>
  Understanding the quick first shell tool in Artemis
</h1>

<p>

<span class=program>ARTEMIS</span> offers several ways to get information from <span class=program>FEFF</span> into a
fitting model. One of these is called a <em>quick
first shell</em> path. It's  purpose is to provide a model-free
way of computing the scattering amplitude and phase shift well enough
to be used for a quick analysis of the first coordination shell.
</p>

<p>
The way it works is quite simple. Given the species of the absorber
and the scatterer, the absorption edge (usually K or L<sub>III</sub>), and a
nominal distance between the absorber and the scatterer, <span class=program>ARTEMIS</span>
constructs input for <span class=program>FEFF</span>. This input data assumes that the absorber
and scatterer are present in a <a href="http://en.wikipedia.org/wiki/Cubic_crystal_system#Rock-salt_structure">rock salt structured</a> crystal. The lattice constant of this
notional cubic crystal is such that the nearest neighbor distance is
the nominal distance supplied by the user. <span class=program>FEFF</span> is run and the
scattering path for the nearest neighbor is retained. The rest of the
<span class=program>FEFF</span> calculation is discarded. The nearest neighbor path is imported
into <span class=program>ARTEMIS</span> with the degeneracy set to 1.
</p>

<p>
The assumption here is that the notional crystal will produce a
scattering amplitude and phase shift for the nearest neighbor path
that is close enough to what would be calculated by <span class=program>FEFF</span> were the
local structure actually known. Does this really work?
</p>

<p>
<hr class=hide />
<a name="usingthequickfirstshelltooltomodelfirstshelldata">
<p>&nbsp;</p>
</a>
</p>

<p>
<h2>  Using the quick first shell tool to model first shell data</h2>
</p>

<p>
To demonstrate what QFS does and to explain the constraints on the
situations in which it can be expected to work, let's take a
look at my favorite teaching example, FeS<sub>2</sub>. Anyone who has attended
one of my XAS training courses has seen this example.
</p>

<p>
These three figures show the S atom in the 1st coordination shell
computed using the known crystal structure for FeS<sub>2</sub>. This
calculation is the blue trace. The red trace is the contribution from
a S atom at the same distance as computed using the quick first shell
tool. These calculations are plotted as &chi;(k), |&chi;(R)|, and
Re[&chi;(R)].
</p>

<p>
<a name=qfs-1st_k>&nbsp;</a><br><a href=../../images/qfs-1st_k.png><img src="../../images/qfs-1st_k.png" width=32%></a><a href=../../images/qfs-1st_rmag.png><img src="../../images/qfs-1st_rmag.png" width=32%></a><a href=../../images/qfs-1st_rre.png><img src="../../images/qfs-1st_rre.png" width=32%></a>
</p>

<p>
As you can see, these two calculations are identical. You cannot even
see the blue trace underneath the red trace. It is clear that the QFS
calculation can be substituted for the more proper <span class=program>FEFF</span> calculation of
the contribution from the nearest neighbor.
</p>

<p>
Why does this work?
</p>

<p>
<span class=program>FEFF</span> starts by calculating neutral atoms then placing these
neutral atoms at the positions indicated by <span class=program>FEFF</span>'s input
data. Each neutral atom has an associated radius &ndash; the radius
within which the &ldquo;cloud&rdquo; of electrons has
the same charge as the nucleus of the atom. The neutral-atom radii are
fairly large. When placed at the positions in the <span class=program>FEFF</span> input data,
these neutral-atom radii overlap significantly. This is a problem for
<span class=program>FEFF</span>'s calculation of the atomic potentials in the material
because it means that electrons in the overlapping regions cannot be
positively identified as belonging to a particular atom.
</p>

<p>
To address this situation, <span class=program>FEFF</span> uses an algorithm called the
Mattheis prescription, which inscribes spheres in <a href="http://en.wikipedia.org/wiki/Wigner%E2%80%93Seitz_cell">Wigner-Seitz cells</a>, to reduce the radii of all atoms in the
material together until the reduced radii are just touching and never
overlapping. These smaller radii are called the muffin-tin radii. The
electron density within one muffin-tin radius is associated with the
atom at the center of that sphere. All of the electron density that
falls outside of the muffin-tin spheres is volumetrically averaged and
treated as interstitial electron density. All the details are
explained in J.J. Rehr and R.A. Albers, <em>Rev. Mod. Phys.</em>, <strong>72</strong>, 
(2000) p.&nbsp;621-654<a href="https://doi.org/10.1103/RevModPhys.72.621"> (DOI: 10.1103/RevModPhys.72.621)</a>.
</p>

<p>
The scattering amplitude and phase shift is then computed from atoms
that have a specific size &ndash; the size of the muffin-tin spheres
&ndash; and with the electron density associated with those spheres.
</p>

<p>
The reason that the two calculations shown above are so similar is
because the muffin-tin radii of the Fe and S atoms are almost
identical. This should not be surprising. Either way of constructing
the muffin tins &ndash; using the proper FeS<sub>2</sub> structure or using
the rock-salt structure &ndash; start with Fe and S atoms separated
by the same amount. The application of the algorithm for producing
muffin-tin sizes ends up with nearly identical values. As a result the
scattering amplitudes and phase shifts are nearly the same and the
resulting &chi;(k) functions are nearly the same.
</p>

<p>
<hr class=hide />
<a name="(mis)usingthequickfirstshelltoolbeyondthefirstshell">
<p>&nbsp;</p>
</a>
</p>

<p>
<h2>  (Mis)Using the quick first shell tool beyond the first shell</h2>
</p>

<p>
This is awesome! It would seem that we have a model independent way to
generate fitting standards for use in <span class=program>ARTEMIS</span>. No more mucking around
with Atoms, no more looking up metalloprotein structures. Just use
QFS!
</p>

<p>
If you think that seems too good to be true &ndash; you get a gold star. It
most certainly is.
</p>

<p>
Following the example above, I now show the second neighbor from the
proper FeS<sub>2</sub> calculation, which is also a S atom and which is at
3.445 &Aring;. The red trace is a QFS path computed with a nominal
distance of 3.445 &Aring;. As you can see, there are substantial
differences, particularly at low k, between the two.
</p>

<p>
<a name=qfs-2nd_k>&nbsp;</a><br><a href=../../images/qfs-2nd_k.png><img src="../../images/qfs-2nd_k.png" width=32%></a><a href=../../images/qfs-2nd_rmag.png><img src="../../images/qfs-2nd_rmag.png" width=32%></a><a href=../../images/qfs-2nd_rre.png><img src="../../images/qfs-2nd_rre.png" width=32%></a>
</p>

<p>
So, why does this not work so well? In the proper calculation, the
size of the S muffin-tin has been determined in large part by the Fe-S
nearest neighbor distance. This same muffin-tin radius is used for all
the S atoms in the cluster. Thus, in the real calculation, the
contribution from the second neighbor S atom is determined using the same
well-constrained S muffin-tin radius as in the 1st shell calculation.
</p>

<p>
In contrast, the QFS calculation has been made with an unphysically
large Fe-S nearest neighbor distance. Remember, the QFS algorithm
works by putting the absorber and scatterer in a rock-salt crystal
with a lattice constant such that the nearest neighbor distance is
equal to the distance supplied by the user. In this case, that nearest
neighbor distance is 3.445 &Aring;!
</p>

<p>
The algorithm for constructing the muffin tins requires that the
muffin-tin spheres touch. Supplied with a distance of 3.445 &Aring;,
the muffin-tin radii are much too large, the electron density within
the muffin tins is much too small, and the scattering amplitude and
phase shift are calculated wrongly.
</p>

<p>
The central problem here is not that the red line is different from
the blue line &ndash; although that is certainly the case and it is
certainly a problem. The central problem is that, by misusing the QFS
tool in this way, you introduce a large systematic error into your
data analysis. This systematic error affects both amplitude and phase
(as you can clearly see in the figures above). What's worse, you
have no way of quantifying this systematic error. Your results for
coordination number, &Delta;R, and &sigma;&sup2; <strong>will</strong> be wrong. And you
have <strong>no way of knowing</strong> by how much.
</p>

<p>
<p class=caution>
<img class=tinyfloatleft border=0 src="../../images/alert.png" alt="Caution!">
In short, if you misuse the QFS tool in this way, you cannot
possibly report a defensible analysis of your data.
</p>
</p>

<p>
To add even more ill cheer to this discussion, the problem gets worse
and worse as the nominal distance of the QFS calculation gets
larger. Here I show the same comparison, this time for the fifth
coordination shell in FeS<sub>2</sub>, another S scatterer at 4.438 &Aring;:
</p>

<p>
<a name=qfs-4th_k>&nbsp;</a><br><a href=../../images/qfs-4th_k.png><img src="../../images/qfs-4th_k.png" width=32%></a><a href=../../images/qfs-4th_rmag.png><img src="../../images/qfs-4th_rmag.png" width=32%></a><a href=../../images/qfs-4th_rre.png><img src="../../images/qfs-4th_rre.png" width=32%></a>
</p>

<p>
<hr class=hide />
<a name="executivesummary">
<p>&nbsp;</p>
</a>
</p>

<p>
<h2>  Executive summary</h2>
</p>

<p>
The quick first shell tool is given that name because it is only valid
for first shell analysis.
</p>

<p>
If you attempt to use the QFS tool at larger distances, you introduce
large systematic error into your data analysis. Don't do that!
</p>

<p>
<hr class=hide />
<a name="so,whatshouldyoudo?">
<p>&nbsp;</p>
</a>
</p>

<p>
<h2>  So, what should you do?</h2>
</p>

<p>
Presumably, you have measured EXAFS on your sample because you because
you do not know its structure. The point of the EXAFS analysis is to
determine the structure. The upshot of this discussion would seem to
be that you need to know the structure in order to measure the
structure. That's a <a href="http://en.wikipedia.org/wiki/Catch-22_%28logic%29">catch-22</a>, right?
</p>

<p>
Not really. As I often say in my lectures during XAS training courses:
you never know nothing. It is rare that you cannot make an educated
guess about what your unknown material might resemble. With that
guess, you can run <span class=program>FEFF</span>, parameterize your fitting model, and
determine the extent to which that guess is consistent with your data.
</p>

<p>
<dl>
  
<dt>
  Crystalline analogs
</dt>
<dd>
<a href="https://doi.org/10.1016/S0016-7037(02)00947-X">In this
paper</a>, Shelly Kelly demonstrates how to use <span class=program>FEFF</span> calculations on
crystalline materials as the basis for interpreting the EXAFS of
uranyl ions adsorbed onto biomass. In that paper, she shows the pH
dependence of the fractionation of the uranyl ions among phosphoryl,
carboxyl, and hydroxyl binding sites. Obviously, there is no way to
make <span class=program>FEFF</span> input data for uranyl ions on organic goo. However, Shelly
realized that the basic structure of the uranyl-phosphoryl or
uranyl-carboxyl ligands are very similar in the organic and inorganic
cases. Thus she ran <span class=program>FEFF</span> on the inorganic structure and pulled out
those paths that describe the uranyl ion in its similar ligation
environment in the organic case.
</p>

<p>
The great advantage of using the inorganic structures is that the
muffin-tin radii are very likely to be computed well. The paths that
describe the uranyl ligation environment have thus been computed
reliably and with good muffin tin radii.  
</p>

<p>
There is yet another advantage to this over attempting to use QFS for
higher shells &ndash; consideration of multiple scattering paths. In the
example from Shelly's paper, there are several small but
non-negligible MS paths to be considered for both carboxyl and
phosphoryl ligands. Neglecting those in favor of a
single-scattering-only model introduces further systematic uncertainty
into the determination of coordination number, &Delta;R, and
&sigma;&sup2;.
  <br />
  <br />
</dd>
<dt>
  SSPaths
</dt>
<dd>
<span class=program>ARTEMIS</span> offers another tool called <a href="../feff/pathlike.html#sspaths">an SSPath</a>.  An SSPath
is a way of using well-constructed muffin tins to compute a scattering
path that is not represented in the input structure provided for the
<span class=program>FEFF</span> calculation.  For example, suppose you run a <span class=program>FEFF</span> calculation on
LaCoO<sub>3</sub>, a trigonal perovskite-like material with 6 oxygen
scatterers at 1.93 &Aring;, 8 La scatterers at 3.28 &Aring; or 3.34
&Aring;, and 6 Co scatterers at 3.83 &Aring;.  Suppose you have some
reason to consider a Co scatterer at 3 &Aring;.  You can tell <span class=program>ARTEMIS</span>
to compute that using the muffin-tin potentials from the LaCoO<sub>3</sub>
calculation, but with a Co scatterer at that distance, which is not
represented in the LaCoO<sub>3</sub> structure.  Unlike an attempt to use a
QFS Co path at that distance, the SSPath uses a scattering potential
with a properly calculated muffin tin.
</p>

<p>
The advantage of the SSPath is that it it results in
a much more accurate calculation than QFS.  The disadvantage is that
it can only be calculated on a scattering element already present in
the <span class=program>FEFF</span> calculation.
  <br />
  <br />
</dd>
</dl>
</p>

<p>
<hr class=hide />
<a name="reproducingtheimagesabove">
<p>&nbsp;</p>
</a>
</p>

<p>
<h2>  Reproducing the images above</h2>
</p>

<p>
To start, I imported the FeS2 data and crystal structure into
<span class=program>ARTEMIS</span>. 
<a href="https://github.com/bruceravel/XAS-Education/tree/master/Examples/FeS2">(You can find them here.)</a>
I ran <span class=program>ATOMS</span>, then <span class=program>FEFF</span>. I then
dragged and dropped the nearest neighbor path onto the Data page. At
this stage, <span class=program>ARTEMIS</span> looks like this:
</p>

<p>
<a href="../../images/qfs-start_qfs.png" target=_blank><img width=75% src="../../images/qfs-start_qfs.png" title="
Getting started with the comparison
" alt="
Getting started with the comparison
"></a>
</p>

<p>
I begin a QFS calculation by selecting that option from the menu on the Data page:
</p>

<p>
<div class=figure style="max-width: 851px; min-width: 7em;">
<a name=qfs-path>
<img src=../../images/qfs-path.png width=100%>
</a>
<p align=center>
Go compute the QFS path
</p>
</div>
</p>

<p>
The nearest neighbor path in FeS<sub>2</sub> is a S atom at 2.257 &Aring;.
</p>

<p>
<div class=smfigureright style="max-width: 347px; min-width: 7em;">
<a name=qfs-make_qfs>
<img src=../../images/qfs-make_qfs.png width=100%>
</a>
<p align=center>
Set the QFS parameters
</p>
</div>
</p>

<p>
Clicking OK, the QFS path is generated.  I set the degeneracy of the
QFS path to 6 so that I can directly compare the normally calculated
path (there are 6 nearest neighbor S atoms in FeS<sub>2</sub>) to the QFS
path.  I mark both paths and transfer them to the plotting list.  I am
now ready to compare these two calculations.  To examine another
single scattering path, I drag and drop that path from the <span class=program>FEFF</span> page
to the Data page and redo the QFS calculation at that distance.
</p>

<p>
<a href="../../images/qfs-compare.png" target=_blank><img width=75% src="../../images/qfs-compare.png" title="
Ready to plot the comparison
" alt="
Ready to plot the comparison
"></a></p>

</div>

<br />
<hr class=hide />
<hr class=bottomdivider />

<div class=bottombar>
  <div class=copyright>
  <table>
    <tr>
      <td colspan=2>
        <span class=program>DEMETER</span> is copyright &copy; 2009-2015 Bruce Ravel
        &mdash;
        This document is copyright &copy; 2015 Bruce Ravel
        <br />
      </td>
    </tr>
    <tr valign=middle>
      <td> 
           <a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="../../images/somerights20.png" width="88" height="31" alt="" border="0" /></a> &nbsp;&nbsp;&nbsp;
      </td>
      <td>
  	This document is licensed under <a href="http://creativecommons.org/licenses/by-sa/3.0/">
  	The Creative Commons Attribution-ShareAlike License</a>.
  	<br />
  	If <span class=program>DEMETER</span> and this document are useful to you, please consider
  	<a href="http://creativecommons.org/support/">supporting The Creative Commons</a>.
      </td>
    </tr>
  </table>
</div>
</div>
  </body>
</html>